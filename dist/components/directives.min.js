angular.module("noviceDirectives",["2lykUtils"]),angular.module("noviceDirectives").directive("noviceList",["lykPropertyAccess","$timeout","lykConsole",function(a,b,c){return{restrict:"EA",templateUrl:function(a,b){return b.templateUrl?b.templateUrl:"novice/template/novice-list/novice-list.html"},transclude:!0,require:"ngModel",scope:{pColumns:"=columns",model:"=ngModel",pSelectFn:"=?selectFn",pSearchFn:"=?searchFn",sortFn:"=?",bottomFn:"=?",querySearchFn:"=?",defaultSort:"@",defaultOrder:"@",hideList:"=?",pButtons:"=?buttons",tableClass:"=?"},link:function(d,e,f,g){function h(a){c.dev("[noviceList]","selectFn"),"function"==typeof d.pSelectFn&&d.pSelectFn(a)}function i(a){c.dev("[noviceList]","searchFn"),"function"==typeof d.pSearchFn&&d.pSearchFn(a)}function j(a,b,d,e){c.dev("[noviceList]","actionFn"),a&&angular.isObject(a)&&"function"==typeof a.action&&a.action(b,d,e)}function k(b,c,d,e){var f,g=a.async.getValue(b,c);return f=g.$$state.value,void 0===f&&d&&d.alternative&&(g=a.async.getValue(b,d.alternative),f=g.$$state.value),!e&&d&&angular.isArray(d.inner)&&angular.isObject(f)&&(f=d.inner.map(function(b){return a.getValue(f,b)}).join(" ")),d&&d.filter&&(f=d.filter(f,c,b)),f}c.dev("[noviceList]"),d.__do=function(){var a=Array.prototype.shift.call(arguments),c=arguments;d[a]&&b(function(){d[a].apply(this,c)},10)},d.youCanStickTheHeader=!1,d.setYouCanStickTheHeader=function(){d.youCanStickTheHeader=!0};var l={};d.isActiveRow=function(a){return l==a},d.activeRow=function(a){l=a};var m="";d.order="asc"==d.defaultOrder,d.sort,d.setSort=function(a,b,c,e){if(b||(d.isSortedBy(a)?d.order=!d.order:d.order=!0),m=a,"function"==typeof d.sortFn)return void d.sortFn(m,d.order);d.sort=function(b){return k(b,a,e)},d.reverse=!d.order},d.isSortedBy=function(a){return m==a},d.getValue=k,d.getArray=function(a,b,c){var e=[];return angular.isObject(a)&&"array"==d.getType(a,b,c)&&(e=k(a,b,c,!0)),e},d.getType=function(b,c,d){if(d.type)return d.type;var e=a.getType(b,c);return"undefined"==e&&d&&d.alternative&&(e=a.getType(b,d.alternative)),e},d.selectFn=h,d.searchFn=i,d.actionFn=j,d.defaultSort=d.defaultSort||"",d.defaultSort&&d.setSort(d.defaultSort,!0),d.loaded=!0,d.$watchCollection("pButtons",function(a){d.buttons=angular.isArray(a)?a:[]},!0),d.$watchCollection("model",function(a){d.rows=a},!0),d.$watchCollection("pColumns",function(a){if(!angular.isArray(a))return void(d.columns=[]);var b=angular.copy(a);d.actionsColumn=b.filter(function(a){return a&&angular.isObject(a)&&"actions"===a.type}),d.actionsColumn=d.actionsColumn.length>0?d.actionsColumn[0]:void 0,d.columns=b.filter(function(a){return angular.isString(a)&&""!=a.trim()||a&&angular.isObject(a)&&(void 0===a.type||angular.isString(a.type)&&-1==["actions"].indexOf(a.type))}).map(function(a){return angular.isString(a)&&(a={id:a}),a.name=a.name||a.id,a.sortable=a.sortable||!1,a.filter=a.filter||void 0,a.class=a.class||"",a.type=a.type||void 0,a.inner=angular.isArray(a.inner)?a.inner:void 0,a.alternative=angular.isString(a.alternative)?a.alternative:void 0,a})},!0)}}}]),angular.module("noviceDirectives").directive("noviceListXhr",["lykPropertyAccess","$timeout","lykXhr","lykConsole",function(a,b,c,d){return{templateUrl:function(a,b){return b.templateUrl?b.templateUrl:"novice/template/novice-list/novice-list-xhr.html"},transclude:!0,scope:{columns:"=",xhr:"<",xhrParams:"<",parametersNames:"<",myButtons:"=?buttons",querySearchFn:"=?",hideFilters:"=?",tableHeight:"=?"},link:function(a,b,e){function f(b){var e={};e[l.limit]=g,e[l.page]=h,e[l.sort]=i,e[l.order]=j,e[l.search]=a.search?encodeURIComponent(a.search):void 0,["limit","page","sort","order","search"].forEach(function(a){void 0!==e[l[a]]&&""!==e[l[a]]||delete e[l[a]]}),c.execute(a.xhr,{params:e},a.xhrParams).then(function(c){if(!c)return d.dev("[noviceListXhr]","No data");if(angular.isArray(c))a.myList=b?c:a.myList.concat(c),d.dev("[noviceListXhr]","size:",a.myList.length);else if(angular.isObject(c)){var e="data";if(angular.isArray(c.docs)&&!angular.isArray(c.data)&&(e="docs"),!angular.isArray(c[e]))return d.dev("[noviceListXhr]","No data");a.myList=b?c[e]:a.myList.concat(c[e]),k=angular.isNumber(c.pages)?c.pages:k}},d.error)}var g=50,h=0,i="",j="",k=1,l={page:"page",limit:"limit",sort:"sort",order:"order",search:"search"};a.parametersNames&&angular.isObject(a.parametersNames)&&Object.keys(a.parametersNames).forEach(function(b){a.parametersNames[b]&&angular.isString(a.parametersNames[b])&&(l[b]=a.parametersNames[b])}),a.myList=[],e.hasOwnProperty("xhrSort")&&(a.sortMyList=function(a,b){i=a,j=b?"asc":"desc",h=0,f(!0)}),a.hideFilters||"function"!=typeof a.querySearchFn||(a.myQuerySearchFn=function(b){return!!a.hideFilters||a.querySearchFn(b,a.search)}),a.loadMore=function(){k<=h+1||(h++,f())},a.doSearch=function(){console.log("[noviceListXhr]","dont knx wut to do")},f()}}}]);